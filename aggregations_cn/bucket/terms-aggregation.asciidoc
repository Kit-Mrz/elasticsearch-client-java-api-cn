[[java-aggs-bucket-terms]]
==== 词条聚合

下面展示了如何使用 Java API 进行{ref}/search-aggregations-bucket-terms-aggregation.html[词条聚合].


===== 创建聚合请求

H下面是一个创建聚合请求的代码示例:

[source,java]
--------------------------------------------------
AggregationBuilders
    .terms("genders")
    .field("gender");
--------------------------------------------------


===== 使用聚合响应

引入聚合定义类:

[source,java]
--------------------------------------------------
import org.elasticsearch.search.aggregations.bucket.terms.Terms;
--------------------------------------------------

[source,java]
--------------------------------------------------
// sr is here your SearchResponse object
Terms genders = sr.getAggregations().get("genders");

// For each entry
for (Terms.Bucket entry : genders.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}
--------------------------------------------------

==== 排序

按照桶的 `doc_count` 的升序排序:

[source,java]
--------------------------------------------------
AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.count(true))
--------------------------------------------------

按照桶中词条的字母的升序排序:

[source,java]
--------------------------------------------------
AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.term(true))
--------------------------------------------------

按照单值的度量子聚合进行桶排序 (按照聚合名称进行标识):

[source,java]
--------------------------------------------------
AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(Terms.Order.aggregation("avg_height", false))
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )
--------------------------------------------------
